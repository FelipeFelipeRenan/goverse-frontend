<div class="min-h-screen bg-gray-50 pb-20">
    <header
        class="bg-white border-b border-gray-200 sticky top-0 z-30 shadow-sm"
    >
        <div
            class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex justify-between items-center"
        >
            <div class="flex items-center gap-2">
                <div class="bg-blue-600 text-white p-1.5 rounded-lg shadow-sm">
                    <svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.39-2.823 1.07-4"
                        />
                    </svg>
                </div>
                <span
                    class="text-xl font-bold text-gray-800 tracking-tight hidden sm:block"
                    >Goverse</span
                >
            </div>

            <div class="flex-1 max-w-lg mx-4 hidden md:block">
                <div class="relative">
                    <div
                        class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                    >
                        <svg
                            class="h-5 w-5 text-gray-400"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                            />
                        </svg>
                    </div>
                    <input
                        type="text"
                        [(ngModel)]="searchTerm"
                        (input)="filterRooms()"
                        class="block w-full pl-10 pr-3 py-2 border border-gray-200 rounded-full leading-5 bg-gray-50 placeholder-gray-500 focus:outline-none focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-all"
                        placeholder="Buscar salas..."
                    />
                </div>
            </div>

            <div class="flex items-center gap-3">
                <button
                    (click)="toProfilePage()"
                    class="flex items-center gap-2 pl-1 pr-3 py-1 rounded-full border border-transparent hover:bg-gray-100 hover:border-gray-200 transition-all group"
                >
                    <img
                        [src]="
                            currentUser?.picture ||
                            '/defaultavatar.jpg'
                        "
                        class="w-8 h-8 rounded-full border border-gray-200 object-cover group-hover:border-blue-400 transition-colors"
                        onerror="this.src='/defaultavatar.jpg'"
                    />
                    <span
                        class="text-sm font-medium text-gray-700 group-hover:text-blue-600 hidden sm:block max-w-[100px] truncate"
                    >
                        {{ currentUser?.username || "Usuário" }}
                    </span>
                </button>

                <div class="h-6 w-px bg-gray-200 mx-1"></div>

                <button
                    (click)="logout()"
                    class="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-full transition-all"
                    title="Sair"
                >
                    <svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                        />
                    </svg>
                </button>
            </div>
        </div>

        <div class="md:hidden px-4 pb-3">
            <input
                type="text"
                [(ngModel)]="searchTerm"
                (input)="filterRooms()"
                class="block w-full px-4 py-2 border border-gray-200 rounded-lg bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"
                placeholder="Buscar salas..."
            />
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8 space-y-12">
        <div
            class="flex flex-col sm:flex-row justify-between items-end sm:items-center gap-4 pb-4 border-b border-gray-200"
        >
            <div>
                <h2 class="text-3xl font-bold text-gray-900">Dashboard</h2>
                <p class="text-gray-500 text-sm mt-1">
                    Gerencie suas salas e conexões
                </p>
            </div>
            <button
                (click)="onCreateRoom()"
                class="flex items-center px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200 font-medium text-sm"
            >
                <svg
                    class="w-5 h-5 mr-2"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 4v16m8-8H4"
                    />
                </svg>
                Nova Sala
            </button>
        </div>

        <section>
            <div class="flex items-center gap-2 mb-6">
                <h3 class="text-lg font-semibold text-gray-800">Suas Salas</h3>
                <span
                    class="px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 text-xs font-bold"
                >
                    {{ filteredOwnedRooms.length }}
                </span>
            </div>

            <div
                *ngIf="loading"
                class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
            >
                <div
                    *ngFor="let i of [1, 2, 3]"
                    class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm h-48 animate-pulse"
                >
                    <div class="flex justify-between items-start mb-4">
                        <div class="h-6 bg-gray-200 rounded w-1/2"></div>
                        <div class="h-6 w-6 bg-gray-200 rounded-full"></div>
                    </div>
                    <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded w-1/2"></div>
                    <div class="mt-auto pt-6 flex justify-between items-center">
                        <div class="h-6 bg-gray-200 rounded-full w-20"></div>
                        <div class="h-4 bg-gray-200 rounded w-12"></div>
                    </div>
                </div>
            </div>

            <div
                *ngIf="!loading"
                class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
            >
                <ng-container
                    *ngIf="filteredOwnedRooms.length > 0; else emptyState"
                >
                    <app-room-card
                        *ngFor="let room of filteredOwnedRooms"
                        [room]="room"
                        color="blue"
                        [showActions]="true"
                        (onDelete)="onDeleteRoom($event)"
                        (onEdit)="onEditRoom($event)"
                    ></app-room-card>
                </ng-container>
            </div>
        </section>

        <section>
            <div class="flex items-center gap-2 mb-6">
                <h3 class="text-lg font-semibold text-gray-800">
                    Salas que participa
                </h3>
                <span
                    class="px-2 py-0.5 rounded-full bg-green-100 text-green-700 text-xs font-bold"
                >
                    {{ filteredJoinedRooms.length }}
                </span>
            </div>

            <div
                *ngIf="loading"
                class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
            >
                <div
                    *ngFor="let i of [1, 2]"
                    class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm h-48 animate-pulse"
                >
                    <div class="h-6 bg-gray-200 rounded w-1/2 mb-4"></div>
                    <div class="h-4 bg-gray-200 rounded w-full mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded w-2/3"></div>
                </div>
            </div>

            <div
                *ngIf="!loading"
                class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
            >
                <ng-container
                    *ngIf="
                        filteredJoinedRooms.length > 0;
                        else emptyStateJoined
                    "
                >
                    <app-room-card
                        *ngFor="let room of filteredJoinedRooms"
                        [room]="room"
                        color="green"
                    ></app-room-card>
                </ng-container>
            </div>
        </section>
    </main>

    <ng-template #emptyState>
        <div
            class="col-span-full py-12 text-center bg-white rounded-xl border border-dashed border-gray-300"
        >
            <div
                class="bg-gray-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4"
            >
                <svg
                    class="w-8 h-8 text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
                    />
                </svg>
            </div>
            <p class="text-gray-500">Nenhuma sala encontrada.</p>
            <button
                (click)="onCreateRoom()"
                class="text-blue-600 hover:underline mt-2 text-sm"
            >
                Criar sua primeira sala
            </button>
        </div>
    </ng-template>

    <ng-template #emptyStateJoined>
        <div
            class="col-span-full py-8 text-center text-gray-400 text-sm italic"
        >
            Você ainda não entrou em nenhuma sala.
        </div>
    </ng-template>

    <app-create-room-modal
        *ngIf="showCreateModal"
        (close)="onModalClose()"
        (roomCreated)="onRoomCreated($event)"
    ></app-create-room-modal>

    <app-edit-room-modal
        *ngIf="roomBeingEdited"
        [room]="roomBeingEdited"
        (close)="onEditModalClose()"
        (updated)="onUpdateRoom($event)"
    ></app-edit-room-modal>
</div>
